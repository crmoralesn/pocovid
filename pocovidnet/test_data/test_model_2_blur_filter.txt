(base) MacBook-Pro-de-Soporte-4:covid19_pocus_ultrasound javierdelao$ python3 pocovidnet/scripts/train_covid19.py --data_dir data/cross_validation/ --fold 0 --epochs 15
Loading images...
Model is called : pocus_fold_0
selected fold: 0
2021-06-28 15:49:53.564901: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2021-06-28 15:49:53.565180: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.

Number of training samples: 781
Number of testing samples: 239
Class mappings are: ['covid' 'pneumonia' 'regular']
Compiling model...
Model has 14747971 parameters
Model: "model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
input_1 (InputLayer)         [(None, 224, 224, 3)]     0
_________________________________________________________________
block1_conv1 (Conv2D)        (None, 224, 224, 64)      1792
_________________________________________________________________
block1_conv2 (Conv2D)        (None, 224, 224, 64)      36928
_________________________________________________________________
block1_pool (MaxPooling2D)   (None, 112, 112, 64)      0
_________________________________________________________________
block2_conv1 (Conv2D)        (None, 112, 112, 128)     73856
_________________________________________________________________
block2_conv2 (Conv2D)        (None, 112, 112, 128)     147584
_________________________________________________________________
block2_pool (MaxPooling2D)   (None, 56, 56, 128)       0
_________________________________________________________________
block3_conv1 (Conv2D)        (None, 56, 56, 256)       295168
_________________________________________________________________
block3_conv2 (Conv2D)        (None, 56, 56, 256)       590080
_________________________________________________________________
block3_conv3 (Conv2D)        (None, 56, 56, 256)       590080
_________________________________________________________________
block3_pool (MaxPooling2D)   (None, 28, 28, 256)       0
_________________________________________________________________
block4_conv1 (Conv2D)        (None, 28, 28, 512)       1180160
_________________________________________________________________
block4_conv2 (Conv2D)        (None, 28, 28, 512)       2359808
_________________________________________________________________
block4_conv3 (Conv2D)        (None, 28, 28, 512)       2359808
_________________________________________________________________
block4_pool (MaxPooling2D)   (None, 14, 14, 512)       0
_________________________________________________________________
block5_conv1 (Conv2D)        (None, 14, 14, 512)       2359808
_________________________________________________________________
block5_conv2 (Conv2D)        (None, 14, 14, 512)       2359808
_________________________________________________________________
block5_conv3 (Conv2D)        (None, 14, 14, 512)       2359808
_________________________________________________________________
block5_pool (MaxPooling2D)   (None, 7, 7, 512)         0
_________________________________________________________________
average_pooling2d (AveragePo (None, 1, 1, 512)         0
_________________________________________________________________
flatten (Flatten)            (None, 512)               0
_________________________________________________________________
dense (Dense)                (None, 64)                32832
_________________________________________________________________
batch_normalization (BatchNo (None, 64)                256
_________________________________________________________________
re_lu (ReLU)                 (None, 64)                0
_________________________________________________________________
dropout (Dropout)            (None, 64)                0
_________________________________________________________________
dense_1 (Dense)              (None, 3)                 195
=================================================================
Total params: 14,747,971
Trainable params: 2,392,963
Non-trainable params: 12,355,008
_________________________________________________________________
Model summary None
Starting training model...
/Users/javierdelao/Library/Python/3.8/lib/python/site-packages/tensorflow/python/keras/engine/training.py:1844: UserWarning: `Model.fit_generator` is deprecated and will be removed in a future version. Please use `Model.fit`, which supports generators.
  warnings.warn('`Model.fit_generator` is deprecated and '
2021-06-28 15:50:09.904757: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:116] None of the MLIR optimization passes are enabled (registered 2)
Epoch 1/15
48/48 [==============================] - 194s 4s/step - loss: 1.1391 - accuracy: 0.4799 - val_loss: 1.2951 - val_accuracy: 0.3640

Epoch 00001: val_accuracy improved from -inf to 0.36402, saving model to models/fold_0_epoch_01
2021-06-28 15:53:24.376776: W tensorflow/python/util/util.cc:348] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.
Balanced accuracy is: {'val_balanced': 0.3333333333333333}
Epoch 2/15
48/48 [==============================] - 175s 4s/step - loss: 0.5859 - accuracy: 0.7584 - val_loss: 1.1859 - val_accuracy: 0.4812

Epoch 00002: val_accuracy improved from 0.36402 to 0.48117, saving model to models/fold_0_epoch_02
Balanced accuracy is: {'val_balanced': 0.5666666666666667}
Epoch 3/15
48/48 [==============================] - 168s 4s/step - loss: 0.4390 - accuracy: 0.8189 - val_loss: 0.9759 - val_accuracy: 0.5272

Epoch 00003: val_accuracy improved from 0.48117 to 0.52720, saving model to models/fold_0_epoch_03
Balanced accuracy is: {'val_balanced': 0.594047619047619}
Epoch 4/15
48/48 [==============================] - 171s 4s/step - loss: 0.3717 - accuracy: 0.8518 - val_loss: 0.8017 - val_accuracy: 0.5900

Epoch 00004: val_accuracy improved from 0.52720 to 0.58996, saving model to models/fold_0_epoch_04
Balanced accuracy is: {'val_balanced': 0.606547619047619}
Epoch 5/15
48/48 [==============================] - 167s 3s/step - loss: 0.3308 - accuracy: 0.8950 - val_loss: 0.8110 - val_accuracy: 0.6025

Epoch 00005: val_accuracy improved from 0.58996 to 0.60251, saving model to models/fold_0_epoch_05
Balanced accuracy is: {'val_balanced': 0.6958333333333333}
Epoch 6/15
48/48 [==============================] - 167s 3s/step - loss: 0.3072 - accuracy: 0.9075 - val_loss: 0.8781 - val_accuracy: 0.5690

Epoch 00006: val_accuracy did not improve from 0.60251
Balanced accuracy is: {'val_balanced': 0.6720238095238096}
Epoch 7/15
48/48 [==============================] - 167s 3s/step - loss: 0.2598 - accuracy: 0.9150 - val_loss: 0.5715 - val_accuracy: 0.7113

Epoch 00007: val_accuracy improved from 0.60251 to 0.71130, saving model to models/fold_0_epoch_07
Balanced accuracy is: {'val_balanced': 0.6982142857142858}
Epoch 8/15
48/48 [==============================] - 169s 4s/step - loss: 0.2990 - accuracy: 0.8851 - val_loss: 0.8544 - val_accuracy: 0.6025

Epoch 00008: val_accuracy did not improve from 0.71130
Balanced accuracy is: {'val_balanced': 0.7011904761904763}
Epoch 9/15
48/48 [==============================] - 180s 4s/step - loss: 0.2636 - accuracy: 0.9200 - val_loss: 0.4497 - val_accuracy: 0.7741

Epoch 00009: val_accuracy improved from 0.71130 to 0.77406, saving model to models/fold_0_epoch_09
Balanced accuracy is: {'val_balanced': 0.7589285714285715}
Epoch 10/15
48/48 [==============================] - 171s 4s/step - loss: 0.2480 - accuracy: 0.9215 - val_loss: 0.5570 - val_accuracy: 0.7322

Epoch 00010: val_accuracy did not improve from 0.77406
Balanced accuracy is: {'val_balanced': 0.7613095238095239}
Epoch 11/15
48/48 [==============================] - 167s 3s/step - loss: 0.2294 - accuracy: 0.9270 - val_loss: 0.5598 - val_accuracy: 0.7322

Epoch 00011: val_accuracy did not improve from 0.77406
Balanced accuracy is: {'val_balanced': 0.7345238095238096}
Epoch 12/15
48/48 [==============================] - 164s 3s/step - loss: 0.2285 - accuracy: 0.9378 - val_loss: 0.6797 - val_accuracy: 0.6862

Epoch 00012: val_accuracy did not improve from 0.77406
Balanced accuracy is: {'val_balanced': 0.755357142857143}
Epoch 13/15
48/48 [==============================] - 167s 3s/step - loss: 0.2135 - accuracy: 0.9266 - val_loss: 0.4189 - val_accuracy: 0.8159

Epoch 00013: val_accuracy improved from 0.77406 to 0.81590, saving model to models/fold_0_epoch_13
Balanced accuracy is: {'val_balanced': 0.794047619047619}
Epoch 14/15
48/48 [==============================] - 164s 3s/step - loss: 0.1674 - accuracy: 0.9591 - val_loss: 0.3755 - val_accuracy: 0.8285

Epoch 00014: val_accuracy improved from 0.81590 to 0.82845, saving model to models/fold_0_epoch_14
Balanced accuracy is: {'val_balanced': 0.796763820470717}
Epoch 15/15
48/48 [==============================] - 167s 3s/step - loss: 0.1962 - accuracy: 0.9442 - val_loss: 0.4954 - val_accuracy: 0.7448

Epoch 00015: val_accuracy did not improve from 0.82845
Balanced accuracy is: {'val_balanced': 0.7355295566502463}
Evaluating network...
classification report sklearn:
              precision    recall  f1-score   support

       covid       0.79      0.62      0.69       112
   pneumonia       0.90      0.97      0.93        87
     regular       0.42      0.62      0.51        40

    accuracy                           0.74       239
   macro avg       0.71      0.74      0.71       239
weighted avg       0.77      0.74      0.75       239

confusion matrix:
[[69  9 34]
 [ 3 84  0]
 [15  0 25]]
Saving COVID-19 detector model on pocus_fold_0 data...
models/pocus_fold_0
Done, shuttting down!
(base) MacBook-Pro-de-Soporte-4:covid19_pocus_ultrasound javierdelao$
